{% extends "base.html" %}
{% block title %}
D·ª± ƒëo√°n Thu nh·∫≠p
{% endblock %}
{% block content %}


<body>
    <div class="card w-full max-w-xl mx-auto my-10 bg-base-100 shadow-xl p-6 md:p-10">

        <div class="card-body p-0">
            <h1 class="text-3xl font-bold text-center text-primary mb-2">
                üìä Trang web D·ª± ƒëo√°n Thu nh·∫≠p
            </h1>
            <p class="text-center text-base-content/80 mb-6">
                Nh·∫≠p th√¥ng tin nh√¢n kh·∫©u h·ªçc ƒë·ªÉ d·ª± ƒëo√°n thu nh·∫≠p (tr√™n ho·∫∑c d∆∞·ªõi $50K/nƒÉm).
            </p>
        </div>

        <form id="income-form" class="space-y-4">

            <label class="form-control w-full">
                <div class="label"><span class="label-text">Tu·ªïi (Age):</span></div>
                <input type="number" id="age" name="age" value="30" required class="input input-bordered w-full"
                    placeholder="V√≠ d·ª•: 30" />
            </label>

            <label class="form-control w-full">
                <div class="label"><span class="label-text">Lo·∫°i h√¨nh C√¥ng vi·ªác (Workclass):</span></div>
                <select id="workclass" name="workclass" class="select select-bordered w-full">
                    <option value="Private">T∆∞ nh√¢n (Private)</option>
                    <option value="Self-emp-not-inc">T·ª± kinh doanh (Self-emp-not-inc)</option>
                    <option value="Local-gov">Ch√≠nh ph·ªß ƒë·ªãa ph∆∞∆°ng (Local-gov)</option>
                    <option value="State-gov">Ch√≠nh ph·ªß ti·ªÉu bang (State-gov)</option>
                    <option value="Federal-gov">Ch√≠nh ph·ªß li√™n bang (Federal-gov)</option>
                    <option value="Self-emp-inc">T·ª± kinh doanh (c√≥ ƒëƒÉng k√Ω)</option>
                    <option value="Without-pay">Kh√¥ng l∆∞∆°ng</option>
                </select>
            </label>

            <label class="form-control w-full">
                <div class="label"><span class="label-text">S·ªë nƒÉm H·ªçc v·∫•n (Education-num):</span></div>
                <input type="number" id="education-num" name="education-num" value="13" required
                    class="input input-bordered w-full" placeholder="V√≠ d·ª•: 13 (C·ª≠ nh√¢n)" />
            </label>

            <label class="form-control w-full">
                <div class="label"><span class="label-text">T√¨nh tr·∫°ng H√¥n nh√¢n (Marital-status):</span></div>
                <select id="marital-status" name="marital-status" class="select select-bordered w-full">
                    <option value="Married-civ-spouse">ƒê√£ k·∫øt h√¥n (v·ª£/ch·ªìng d√¢n s·ª±)</option>
                    <option value="Never-married">Ch∆∞a k·∫øt h√¥n</option>
                    <option value="Divorced">ƒê√£ ly h√¥n</option>
                    <option value="Separated">Ly th√¢n</option>
                    <option value="Widowed">G√≥a</option>
                </select>
            </label>

            <label class="form-control w-full">
                <div class="label"><span class="label-text">S·ªë gi·ªù l√†m m·ªói tu·∫ßn (Hours-per-week):</span></div>
                <input type="number" id="hours-per-week" name="hours-per-week" value="40" required
                    class="input input-bordered w-full" placeholder="V√≠ d·ª•: 40" />
            </label>

            <label class="form-control w-full">
                <div class="label"><span class="label-text">L·ª£i nhu·∫≠n v·ªën (Capital-gain):</span></div>
                <input type="number" id="capital-gain" name="capital-gain" value="0" required
                    class="input input-bordered w-full" placeholder="V√≠ d·ª•: 0 ho·∫∑c 2174" />
            </label>

            <label class="form-control w-full">
                <div class="label"><span class="label-text">T·ªïn th·∫•t v·ªën (Capital-loss):</span></div>
                <input type="number" id="capital-loss" name="capital-loss" value="0" required
                    class="input input-bordered w-full" placeholder="V√≠ d·ª•: 0" />
            </label>

            <button type="submit" class="btn btn-primary w-full mt-6">
                D·ª± ƒëo√°n Thu nh·∫≠p
            </button>
        </form>

        <div id="result-container" class="mt-8 pt-4 border-t border-base-200 text-center">
            <h2 class="text-xl font-semibold mb-2">K·∫øt qu·∫£ D·ª± ƒëo√°n:</h2>
            <div role="alert" class="alert shadow-lg justify-center p-4">
                <p class="loading loading-spinner text-info" id="loading" style="display:none;"></p>
                <p id="result" class="text-2xl font-extrabold text-success">---</p>
            </div>
        </div>
    </div>
    <script>
        document.getElementById('income-form').addEventListener('submit', function (e) {
            e.preventDefault();

            // Hi·ªÉn th·ªã tr·∫°ng th√°i "ƒêang x·ª≠ l√Ω"
            const resultEl = document.getElementById('result');
            const loadingEl = document.getElementById('loading');
            resultEl.innerText = '---';
            loadingEl.style.display = 'block';

            // 1. Thu th·∫≠p d·ªØ li·ªáu t·ª´ c√°c √¥ input
            const data = {
                'age': parseInt(document.getElementById('age').value),
                'workclass': document.getElementById('workclass').value,
                'education-num': parseInt(document.getElementById('education-num').value),
                'marital-status': document.getElementById('marital-status').value,
                'hours-per-week': parseInt(document.getElementById('hours-per-week').value),
                'capital-gain': parseInt(document.getElementById('capital-gain').value),
                'capital-loss': parseInt(document.getElementById('capital-loss').value)

                // L∆∞u √Ω: Ch√∫ng ta ch·ªâ c·∫ßn g·ª≠i c√°c c·ªôt c√≥ trong form.
                // Backend (app.py) s·∫Ω t·ª± ƒë·ªông x·ª≠ l√Ω c√°c c·ªôt c√≤n l·∫°i.
            };
            // G·ª≠i d·ªØ li·ªáu ƒë·∫øn URL API Django
            fetch('/app/api/predict/', {  // CH·ªàNH S·ª¨A URL: '/predict/'
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    // Django c·∫ßn token CSRF n·∫øu l√† form truy·ªÅn th·ªëng, 
                    // nh∆∞ng v·ªõi fetch/JSON, ch√∫ng ta d√πng @csrf_exempt trong views.py
                },
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(data => {
                    // 3. Hi·ªÉn th·ªã k·∫øt qu·∫£
                    loadingEl.style.display = 'none';
                    if (data.prediction) {
                        resultEl.innerText = `Thu nh·∫≠p: ${data.prediction}`;
                    } else {
                        resultEl.innerText = `L·ªói: ${data.error}`;
                    }
                })
                .catch(error => {
                    // 4. X·ª≠ l√Ω n·∫øu c√≥ l·ªói
                    loadingEl.style.display = 'none';
                    console.error('Error:', error);
                    resultEl.innerText = 'ƒê√£ x·∫£y ra l·ªói khi k·∫øt n·ªëi server.';
                });
        });
    </script>
</body>
{% endblock %}