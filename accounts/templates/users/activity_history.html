{% extends "base.html" %}
{% block title %}
Lịch sử Dự đoán{% endblock %}
{% block content %}
<div class="container mx-auto p-4 max-w-4xl">
    <h1 class="text-3xl font-bold mb-6 text-center">Lịch sử Dự đoán của {{ user.username }}</h1>

    {% if count == 0 %}
    <div role="alert" class="alert alert-info">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span>Bạn chưa có bản ghi dự đoán nào.</span>
    </div>
    {% else %}
    <p class="text-sm text-gray-500 mb-4">Tổng số bản ghi: {{ count }}</p>

    <div class="overflow-x-auto bg-white shadow-lg rounded-xl">
        <table class="table w-full">
            <thead class="bg-gray-100">
                <tr>
                    <th>#</th>
                    <th>Kết quả Dự đoán</th>
                    <th>Xác suất</th>
                    <th>Thời gian</th>
                    <th>Chi tiết Input</th>
                </tr>
            </thead>
            <tbody>
                {% for record in history %}
                <tr class="hover:bg-gray-50">
                    <th>{{ forloop.counter }}</th>

                    <td>
                        {% if record.output_result == '>50K' %}
                        <div class="badge badge-success">{{ record.output_result }}</div>
                        {% else %}
                        <div class="badge badge-error">{{ record.output_result }}</div>
                        {% endif %}
                    </td>

                    <td class="font-mono text-sm">{{ record.probability }}%</td>

                    <td class="text-xs text-gray-500">{{ record.prediction_date|date:"H:i d/m/Y" }}</td>

                    <td>
                        <details class="dropdown dropdown-left">
                            <summary class="m-1 btn btn-xs btn-ghost">Xem Input</summary>
                            <ul
                                class="p-2 shadow menu dropdown-content z-[1] bg-base-100 rounded-box w-72 max-h-60 overflow-y-auto">
                                {% for key, value in record.input_data.items %}
                                <li><a class="text-xs p-1"><strong>{{ key|upper }}:</strong> {{ value }}</a></li>
                                {% endfor %}
                            </ul>
                        </details>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center text-gray-400">Không tìm thấy bản ghi nào.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
</div>
{% endblock %}